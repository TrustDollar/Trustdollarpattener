 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deposit</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* âœ… Same CSS as tumne diya tha (no change) */
    body {font-family:'Poppins',sans-serif;background:#f5f7fa;margin:0;padding:20px;padding-bottom:100px;color:#333;}
    h1{text-align:center;margin-bottom:20px;color:#222;}
    .dashboard{max-width:800px;margin:auto;background:#fff;border-radius:16px;padding:25px;box-shadow:0 6px 20px rgba(0,0,0,0.1);text-align:center;}
    .info-card{margin-top:20px;background:#fff;border-radius:16px;padding:25px;box-shadow:0 6px 20px rgba(0,0,0,0.1);}
    .btn{padding:12px 20px;font-size:16px;font-weight:bold;border:none;border-radius:10px;cursor:pointer;color:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
    .btn-deposit{background:#28a745;}.btn-deposit:hover{background:#218838;}
    .popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:2000;}
    .popup{background:#fff;border-radius:16px;padding:20px;width:90%;max-width:350px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.3);animation:fadeIn 0.3s ease;margin:auto;display:flex;flex-direction:column;align-items:center;}
    @keyframes fadeIn{from{opacity:0;transform:scale(0.9);}to{opacity:1;transform:scale(1);}}
    .qr-code{margin:15px auto;padding:10px;border:2px solid #ddd;border-radius:12px;background:#fafafa;display:inline-block;}
    .address-box{background:#f5f7fa;padding:10px;border-radius:10px;font-size:14px;word-break:break-all;margin-top:10px;width:100%;}
    .amount-input{width:100%;padding:10px;margin-top:12px;border:1px solid #ccc;border-radius:8px;font-size:14px;outline:none;text-align:center;}
    .amount-input:disabled{background:#e9ecef;color:#555;font-weight:bold;}
    .amount-instruction{font-size:14px;font-weight:bold;color:#007bff;margin-top:10px;display:none;}
    .copy-btn{background:#28a745;color:#fff;padding:10px;border:none;border-radius:8px;margin-top:12px;cursor:pointer;font-weight:bold;width:100%;}
    .action-buttons{display:flex;justify-content:space-between;gap:10px;margin-top:12px;width:100%;}
    .action-buttons button{flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;color:#fff;}
    .close-btn{background:#dc3545;}.paid-btn{background:#007bff;}
    .history-section{margin-top:30px;}
    .history-card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08);font-size:14px;}
    .history-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .badge{background:#28a745;color:#fff;padding:3px 10px;border-radius:6px;font-weight:bold;font-size:13px;}
    .status.complete{color:green;font-weight:bold;}.status.pending{color:#ff8800;font-weight:bold;}.status.canceled{color:red;font-weight:bold;}.status.paid{color:#007bff;font-weight:bold;}
    .history-card-row{display:flex;justify-content:space-between;margin:6px 0;}
    .history-card-row span.label{font-weight:600;color:#444;}
    .history-card-row span.value{font-weight:bold;color:#ff8800;}
    .history-card-row small{color:#666;}
    .thankyou-popup,.error-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:15px 25px;border-radius:12px;font-weight:bold;box-shadow:0 6px 20px rgba(0,0,0,0.3);z-index:3000;display:none;animation:fadeInOut 1.5s ease forwards;}
    .thankyou-popup{background:#28a745;color:#fff;}.error-popup{background:#dc3545;color:#fff;}
    @keyframes fadeInOut{0%{opacity:0;transform:translate(-50%,-50%) scale(0.9);}20%{opacity:1;transform:translate(-50%,-50%) scale(1);}80%{opacity:1;}100%{opacity:0;transform:translate(-50%,-50%) scale(0.9);}}
    .refresh-btn{background:#17a2b8;color:#fff;padding:10px 18px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;margin:10px auto;display:block;}
    .refresh-btn:hover{background:#138496;}

       /* ðŸŒŠ Wave Bottom Navbar */
    .wave-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 70px;
      background: linear-gradient(135deg, #007bff, #00c6ff);
      clip-path: polygon(0 20%, 15% 0, 85% 0, 100% 20%, 100% 100%, 0 100%);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
    }
    .wave-nav a {
      flex: 1;
      text-align: center;
      font-size: 13px;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      display: flex;
      flex-direction: column;   /* ðŸ‘ˆ icon upar, text neeche */
      align-items: center;
      justify-content: center;
      transition: 0.3s;
    }
    .wave-nav a:hover { opacity: 0.85; }
    .wave-nav a.active { color: #ffeb3b; }
    .wave-nav i {
      font-size: 22px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>

  
  <div class="dashboard">
    <div class="info-card">
     
      <p>Click below to get your <b>BEP20 deposit address</b> with QR code.</p>
      <button class="btn btn-deposit" onclick="openPopup()">Get Deposit Address</button>
    </div>

    <div class="history-section">
      <h2 style="color:#007bff; text-align:center;"> Deposit History</h2>
      <div id="historyList"><p style="text-align:center; color:#666;">Loading...</p></div>
    </div>
  </div>

  <button class="refresh-btn" onclick="manualRefresh()">ðŸ”„ Refresh History</button>

  <!-- âœ… Popup -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <h2>Deposit Funds</h2>
      <input type="number" id="depositAmount" class="amount-input" placeholder="Enter amount to deposit">
      <div id="amountInstruction" class="amount-instruction"></div>
      <div id="qrcode" class="qr-code"></div>
      <div class="address-box" id="depositAddress"></div>
      <button class="copy-btn" onclick="copyAddress()">Copy Address</button>
      <div class="action-buttons">
        <button class="close-btn" onclick="cancelDeposit()">Cancel</button>
        <button class="paid-btn" onclick="markPaid()">I Have Paid</button>
      </div>
    </div>
  </div>

  <div class="thankyou-popup" id="thankyouPopup">Thank you for paying </div>
  <div class="error-popup" id="errorPopup">Enter valid amount</div>

   <!-- ðŸŒŠ Wave Bottom Navigation -->
  <div class="wave-nav">
    <a href="dashboard.html" class="active">
      <i data-lucide="home"></i>
      <span>Home</span>
    </a>
    <a href="investment.html">
      <i data-lucide="trending-up"></i>
      <span>Invest</span>
    </a>
    <a href="account.html">
      <i data-lucide="user"></i>
      <span>Account</span>
    </a>
  </div>

  <!-- âœ… Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script> lucide.createIcons(); </script>


  <!-- âœ… QRCode Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

  <!-- âœ… Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
      authDomain: "btcinvest-c0e25.firebaseapp.com",
      projectId: "btcinvest-c0e25",
      storageBucket: "btcinvest-c0e25.firebasestorage.app",
      messagingSenderId: "204937458487",
      appId: "1:204937458487:web:cc27ece1249999279f60b2",
      measurementId: "G-HG0Q8ZHT6G"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const popupOverlay = document.getElementById("popupOverlay");
    const depositAddressEl = document.getElementById("depositAddress");
    const qrCodeEl = document.getElementById("qrcode");
    const historyList = document.getElementById("historyList");
    const thankyouPopup = document.getElementById("thankyouPopup");
    const errorPopup = document.getElementById("errorPopup");
    const instructionEl = document.getElementById("amountInstruction");

    function generateOrderId() {
      const randomNum = Math.floor(1000000000 + Math.random() * 9000000000);
      return "DPBHGR" + randomNum + "G";
    }

    const depositAddresses = [
      "0x6cf5f8F9564205C6AB3dE1694F54374e70dD135A",
      "0x9ad288c9835Cfe30141677444A0A637a434Cd9bC",
      "0x9d6Dc16a1E5aC1CC3b4e7F500f4BdB51D8fBc301",
      "0x1E807c2AeC3165C37A8b47034839654033bD8cf2"
    ];

    let currentDepositAddress = "";
    let currentUserId = null;
    let currentDepositId = null;

    function showError(msg) {
      errorPopup.textContent = msg;
      errorPopup.style.display = "block";
      setTimeout(() => { errorPopup.style.display = "none"; }, 1500);
    }

    window.openPopup = async function() {
      popupOverlay.style.display = "flex";
      const amountInput = document.getElementById("depositAmount");
      amountInput.value = "";
      amountInput.disabled = false;
      instructionEl.style.display = "none";

      currentDepositAddress = depositAddresses[Math.floor(Math.random() * depositAddresses.length)];
      depositAddressEl.textContent = currentDepositAddress;
      qrCodeEl.innerHTML = "";
      new QRCode(qrCodeEl, { text: currentDepositAddress, width: 180, height: 180 });

      if (currentUserId) {
        const orderId = generateOrderId();
        const ref = await addDoc(collection(db, "users", currentUserId, "deposits"), {
          amount: 0,
          address: currentDepositAddress,
          date: serverTimestamp(),
          status: "Pending",
          orderId: orderId
        });
        currentDepositId = ref.id;
        loadDepositHistory(currentUserId);
      }
    };

    window.cancelDeposit = async function() {
      popupOverlay.style.display = "none";
      qrCodeEl.innerHTML = "";
      if (currentUserId && currentDepositId) {
        const ref = doc(db, "users", currentUserId, "deposits", currentDepositId);
        await updateDoc(ref, { status: "Canceled" });
        loadDepositHistory(currentUserId);
      }
    };

    window.copyAddress = function() {
      navigator.clipboard.writeText(currentDepositAddress);
      showError("Address copied!");
    };

    window.markPaid = async function() {
      const amountInput = document.getElementById("depositAmount");
      const amount = parseFloat(amountInput.value) || 0;
      if (amount <= 0) { showError("Enter valid amount"); return; }
      if (amount < 200) { showError("Minimum is $200"); return; }

      amountInput.disabled = true;
      instructionEl.style.display = "block";
      instructionEl.textContent = `Send the exact amount you entered: $${amount}`;

      popupOverlay.style.display = "none";
      qrCodeEl.innerHTML = "";

      if (currentUserId && currentDepositId) {
        const ref = doc(db, "users", currentUserId, "deposits", currentDepositId);
        await updateDoc(ref, { status: "Paid", amount: amount });
        loadDepositHistory(currentUserId);
      }

      thankyouPopup.style.display = "block";
      setTimeout(() => { thankyouPopup.style.display = "none"; }, 2000);
    };

    window.manualRefresh = function() {
      if (currentUserId) loadDepositHistory(currentUserId);
    };

    async function loadDepositHistory(userId) {
      historyList.innerHTML = "<p style='text-align:center; color:#666;'>Loading...</p>";
      try {
        const q = query(collection(db, "users", userId, "deposits"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        if (querySnapshot.empty) {
          historyList.innerHTML = "<p style='text-align:center; color:#666;'>No deposits yet.</p>";
          return;
        }
        historyList.innerHTML = "";
        querySnapshot.forEach(docSnap => {
          const data = docSnap.data();
          const dateStr = data.date ? new Date(data.date.seconds*1000).toLocaleString() : "-";
          const statusClass = (data.status || "Pending").toLowerCase();
          historyList.innerHTML += `
            <div class="history-card">
              <div class="history-card-header">
                <span class="badge">Deposit</span>
                <span class="status ${statusClass}">${data.status || "Pending"}</span>
              </div>
              <div class="history-card-row"><span class="label">Balance</span><span class="value">$${data.amount || 0}</span></div>
              <div class="history-card-row"><span class="label">Type</span><span>BEP20</span></div>
              <div class="history-card-row"><span class="label">Time</span><small>${dateStr}</small></div>
              <div class="history-card-row"><span class="label"> ID</span>
                <span><small id="order-${docSnap.id}">${data.orderId || docSnap.id}</small>
                <button onclick="copyOrderId('${data.orderId || docSnap.id}')">Copy</button></span>
              </div>
            </div>`;
        });
      } catch (err) {
        console.error("Error:", err);
        historyList.innerHTML = "<p style='text-align:center; color:red;'>Error loading history</p>";
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = "auth.html";
      else { currentUserId = user.uid; loadDepositHistory(user.uid); }
    });

    window.copyOrderId = function(orderId) {
      navigator.clipboard.writeText(orderId);
      showError("Order ID copied!");
    };
      // âœ… Navbar Highlight Logic
  document.querySelectorAll(".wave-nav a").forEach(link => {
    if (link.href === window.location.href) {
      link.classList.add("active");
    } else {
      link.classList.remove("active");
    }
  });
  </script>
</body>
</html>
